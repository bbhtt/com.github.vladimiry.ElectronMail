{
  "app-id": "com.github.vladimiry.ElectronMail",
  "base": "org.electronjs.Electron2.BaseApp",
  "base-version": "19.08",
  "runtime": "org.freedesktop.Platform",
  "runtime-version": "19.08",
  "sdk": "org.freedesktop.Sdk",
  "branch": "beta",
  "command": "electron-mail-entrypoint",
  "rename-desktop-file": "electron-mail.desktop",
  "rename-icon": "electron-mail",
  "finish-args": [
    "--device=dri",
    "--filesystem=xdg-download",
    "--share=ipc",
    "--share=network",
    "--socket=pulseaudio",
    "--socket=x11",
    "--talk-name=org.freedesktop.Notifications",
    "--talk-name=org.kde.StatusNotifierWatcher",
    "--talk-name=org.freedesktop.secrets"
  ],
  "modules": [
    "shared-modules/libsecret/libsecret.json",
    {
      "name": "electron-mail",
      "buildsystem": "simple",
      "build-commands": [
        "mkdir -p ./debian-source-unpacked",
        "ar xo --output=./debian-source-unpacked *.deb",
        "rm -f *.deb",
        "tar xf ./debian-source-unpacked/data.tar.xz -C /app --strip-components=2 ./opt ./usr",
        "rm -rf ./debian-source-unpacked",
        "rm -rf /app/share/icons/hicolor/1024x1024/",
        "install -Dm755 electron-mail-entrypoint.sh /app/bin/electron-mail-entrypoint",
        "chmod -R a-s,go+rX,go-w /app/ElectronMail",
        "desktop-file-edit --set-key=Exec --set-value=\"/app/bin/electron-mail-entrypoint --js-flags=\\\"--max-old-space-size=6144\\\" %U\" /app/share/applications/electron-mail.desktop",
        "install -Dm644 -t /app/share/metainfo ${FLATPAK_ID}.appdata.xml"
      ],
      "sources": [
        {
          "type": "file",
          "dest-filename": "electron-mail.deb",
          "url": "https://github.com/vladimiry/ElectronMail/releases/download/v4.6.0/electron-mail-4.6.0-linux-amd64.deb",
          "sha256": "2cbc115bb9a1895ae6e158534feb751f46ccb9ba7dbe180a01e4685caa470488"
        },
        {
          "type": "script",
          "dest-filename": "electron-mail-entrypoint.sh",
          "commands": [
            "export TMPDIR=\"$XDG_RUNTIME_DIR/app/${FLATPAK_ID}\"",
            "exec zypak-wrapper /app/ElectronMail/electron-mail \"$@\""
          ]
        }
      ]
    }
  ]
}
